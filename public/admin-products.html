<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel | Product Management</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Poppins:wght@300;400;500&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Poppins", sans-serif;
        color: #333;
        background-color: #f5f7fb;
        line-height: 1.6;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 15px;
      }

      /* Header Styles */
      header {
        background: linear-gradient(to right, #4a6fa5, #3c5a8a);
        padding: 20px 0;
        color: white;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .header-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        font-family: "Montserrat", sans-serif;
        font-size: 28px;
        font-weight: 700;
        letter-spacing: 1px;
      }

      .nav-links {
        display: flex;
        gap: 25px;
      }

      .nav-links a {
        color: white;
        text-decoration: none;
        font-weight: 500;
        transition: opacity 0.3s;
        padding: 8px 15px;
        border-radius: 5px;
      }

      .nav-links a.active {
        background: rgba(255, 255, 255, 0.2);
      }

      .nav-links a:hover {
        background: rgba(255, 255, 255, 0.15);
      }

      /* Page Title */
      .page-title {
        text-align: center;
        padding: 40px 0;
        background-color: #fff;
        margin: 20px 0;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      }

      .page-title h1 {
        font-family: "Montserrat", sans-serif;
        font-size: 36px;
        font-weight: 700;
        color: #333;
        margin-bottom: 10px;
      }

      .page-title p {
        color: #666;
        font-size: 16px;
      }

      /* Products Grid */
      .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 25px;
        margin-bottom: 50px;
      }

      .product-card {
        background: #fff;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        transition: transform 0.3s, box-shadow 0.3s;
        cursor: pointer;
      }

      .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
      }

      .product-image {
        height: 200px;
        overflow: hidden;
        background-color: #f5f5f5;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
      }

      .product-image img {
        max-width: 100%;
        max-height: 180px;
        object-fit: contain;
        transition: transform 0.5s;
      }

      .product-card:hover .product-image img {
        transform: scale(1.05);
      }

      .product-info {
        padding: 15px;
      }

      .product-name {
        font-weight: 600;
        font-size: 16px;
        margin-bottom: 8px;
        color: #333;
      }

      .product-price {
        color: #e91e63;
        font-weight: 700;
        font-size: 18px;
      }

      .edit-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s;
      }

      .product-card:hover .edit-overlay {
        opacity: 1;
        display: flex;
      }

      .edit-btn {
        background: #4a6fa5;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: background 0.3s;
      }

      .edit-btn:hover {
        background: #3c5a8a;
      }

      /* Loading Spinner */
      .loading-spinner {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 50px;
      }

      .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid rgba(0, 0, 0, 0.1);
        border-radius: 50%;
        border-top: 4px solid #4a6fa5;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Error Message */
      .error-message {
        background: #fff2f0;
        border: 1px solid #ffccc7;
        border-radius: 5px;
        padding: 20px;
        text-align: center;
        color: #ff4d4f;
        margin: 20px 0;
      }

      /* Footer */
      footer {
        background: #222;
        color: #fff;
        padding: 60px 0 30px;
        margin-top: 50px;
      }

      .footer-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 40px;
      }

      .footer-section h3 {
        font-family: "Montserrat", sans-serif;
        font-size: 18px;
        margin-bottom: 20px;
        position: relative;
        padding-bottom: 10px;
      }

      .footer-section h3:after {
        content: "";
        position: absolute;
        left: 0;
        bottom: 0;
        width: 40px;
        height: 2px;
        background: #4a6fa5;
      }

      .footer-contact p {
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .footer-contact i {
        color: #4a6fa5;
        width: 20px;
      }

      .copyright {
        text-align: center;
        padding-top: 30px;
        margin-top: 30px;
        border-top: 1px solid #444;
        color: #999;
        font-size: 14px;
      }

      /* Responsive Design */
      @media (max-width: 992px) {
        .header-container {
          flex-direction: column;
          gap: 15px;
        }

        .nav-links {
          flex-wrap: wrap;
          justify-content: center;
        }

        .products-grid {
          grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        }
      }

      @media (max-width: 768px) {
        .products-grid {
          grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
          gap: 15px;
        }

        .product-image {
          height: 150px;
        }

        .product-info {
          padding: 10px;
        }

        .product-name {
          font-size: 14px;
        }

        .product-price {
          font-size: 16px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header>
      <div class="container header-container">
        <div class="logo">ADMIN PANEL</div>
        <div class="nav-links">
          <a href="./admin.html">Add Product</a>
          <a href="./admin-products.html" class="active">View All Products</a>
        </div>
      </div>
    </header>

    <!-- Page Title -->
    <div class="container">
      <div class="page-title">
        <h1>PRODUCT MANAGEMENT</h1>
        <p>View and manage all products here</p>
      </div>
    </div>

    <!-- Loading Spinner -->
    <div class="container">
      <div id="loadingSpinner" class="loading-spinner">
        <div class="spinner"></div>
      </div>
    </div>

    <!-- Error Message (hidden by default) -->
    <div class="container">
      <div id="errorMessage" class="error-message" style="display: none">
        <i class="fas fa-exclamation-circle"></i>
        <span id="errorText"
          >There was an error loading products. Please try again.</span
        >
      </div>
    </div>

    <!-- Products Grid -->
    <div class="container">
      <div class="products-grid" id="productsGrid" style="display: none">
        <!-- Product cards will be dynamically generated here -->
      </div>
    </div>

    <!-- Footer -->
    <footer>
      <div class="container footer-container">
        <div class="footer-section">
          <h3>About The Admin Panel</h3>
          <p>
            This Admin Panel is a comprehensive product management system for
            e-commerce businesses. In it you can Manage all your products.
          </p>
        </div>

        <div class="footer-section">
          <h3>About The Developer</h3>
          <p>
            The developer is a passionate builder of scalable and efficient web
            applications especially in the Backend development side of things.
            He is proficient in JavaScript, Node.js, Next.js etc, with a solid
            understanding of Software Development principles and a keen eye for
            detail and organisation.
          </p>
        </div>

        <!-- <div class="footer-section">
          <h3>Quick Links</h3>
          <ul>
            <li><a href="#">Dashboard</a></li>
            <li><a href="#">Products</a></li>
            <li><a href="#">Orders</a></li>
            <li><a href="#">Customers</a></li>
            <li><a href="#">Settings</a></li>
          </ul>
        </div> -->

        <div class="footer-section footer-contact">
          <h3>Contact</h3>
          <p><i class="fas fa-map-marker-alt"></i> Lagos, Nigeria</p>
          <p><i class="fas fa-phone"></i> +123 (916) 697-3321</p>
          <p><i class="fas fa-envelope"></i> nelsonhennessiayodeji@gmail.com</p>
        </div>
      </div>

      <div class="copyright">
        <p>
          © 2025
          <a href="https://nelsonhennessiayodeji.github.io/Nelson-Ayodeji/"
            >Ayodeji Nelson</a
          >. All rights reserved.
        </p>
      </div>
    </footer>

    <script>
      const baseUrl = "/admin-api";

      // Function to show loading spinner
      function showLoading() {
        document.getElementById("loadingSpinner").style.display = "flex";
        document.getElementById("productsGrid").style.display = "none";
        document.getElementById("errorMessage").style.display = "none";
      }

      // Function to hide loading spinner and show products
      function showProducts() {
        document.getElementById("loadingSpinner").style.display = "none";
        document.getElementById("productsGrid").style.display = "grid";
        document.getElementById("errorMessage").style.display = "none";
      }

      // Function to show error message
      function showError(message) {
        document.getElementById("loadingSpinner").style.display = "none";
        document.getElementById("productsGrid").style.display = "none";
        document.getElementById("errorMessage").style.display = "block";
        document.getElementById("errorText").textContent = message;
      }

      async function getAllProducts() {
        try {
          const response = await fetch(`${baseUrl}/products`, {
            method: "GET",
          });

          if (response.ok) {
            const products = await response.json();
            return products;
          } else {
            throw new Error("Failed to fetch products");
          }
        } catch (error) {
          console.error("Error fetching products:", error);
          throw error;
        }
      }

      // Function to render products
      async function renderProducts() {
        showLoading();

        try {
          const products = await getAllProducts();

          if (products.error) {
            showError(products.error);
            return;
          }

          const productsGrid = document.querySelector(".products-grid");
          productsGrid.innerHTML = "";

          if (products.length === 0) {
            showError("No products found. Add some products to get started.");
            return;
          }

          products.forEach((product) => {
            const productCard = document.createElement("div");
            productCard.className = "product-card";
            productCard.setAttribute("data-id", product.id);

            productCard.innerHTML = `
              <div class="product-image">
                <img src="${product.main_image_url}" alt="${product.product_name}">
                <div class="edit-overlay">
                  <button class="edit-btn"><i class="fas fa-edit"></i> Edit Product</button>
                </div>
              </div>
              <div class="product-info">
                <div class="product-name">${product.product_name}</div>
                <div class="product-price">₦${product.price}</div>
              </div>
            `;

            productsGrid.appendChild(productCard);
          });

          showProducts();
          addProductCardListeners();
        } catch (error) {
          console.error("Error rendering products:", error);
          showError("There was an issue loading products. Please try again.");
        }
      }

      // Function to handle product card clicks
      function addProductCardListeners() {
        const productCards = document.querySelectorAll(".product-card");

        productCards.forEach((card) => {
          card.addEventListener("click", function (e) {
            // Don't trigger if the click was on the edit button
            if (e.target.closest(".edit-btn")) {
              return;
            }

            const productId = this.getAttribute("data-id");
            navigateToEditPage(productId);
          });

          // Add specific listener for edit buttons
          const editBtn = card.querySelector(".edit-btn");
          if (editBtn) {
            editBtn.addEventListener("click", function (e) {
              e.stopPropagation(); // Prevent the card click event
              const productId = card.getAttribute("data-id");
              navigateToEditPage(productId);
            });
          }
        });
      }

      // Function to navigate to edit page
      function navigateToEditPage(productId) {
        // Save the product ID to localStorage
        localStorage.setItem("ProductId", productId);
        window.location.href = "admin-edit.html";
      }

      // Initialize the page
      document.addEventListener("DOMContentLoaded", function () {
        renderProducts();
      });
    </script>
  </body>
</html>
